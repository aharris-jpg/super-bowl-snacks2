<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Where Super Bowl Hosts Get Judged on Snacks — by State</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- D3 + TopoJSON -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

  <style>
    :root{
      --bgTop:#e9fbf6;
      --bgBottom:#fff6f2;

      --ink:#1a2730;
      --muted:rgba(26,39,48,0.70);

      --accent:#1a2730;

      --card:rgba(255,255,255,0.70);
      --border:rgba(26,39,48,0.10);
      --shadow:0 18px 46px rgba(0,0,0,0.12);

      --radius:18px;

      --mapStroke:#ffffff;
      --mapStrokeW:6.2;

      --font: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family:var(--font);
      color:var(--ink);
      min-height:100vh;
      padding:22px 14px 26px;
      background:
        radial-gradient(1000px 620px at 75% 18%, rgba(255,179,199,0.28), transparent 55%),
        radial-gradient(900px 640px at 20% 18%, rgba(168,230,222,0.26), transparent 56%),
        radial-gradient(900px 650px at 55% 88%, rgba(255,198,168,0.26), transparent 58%),
        linear-gradient(180deg, var(--bgTop), var(--bgBottom));
      overflow-x:hidden;
    }

    .wrap{ max-width:1040px; margin:0 auto; }

    .hero{
      padding:10px 0 12px;
      margin-bottom:12px;
    }

    .kicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(26,39,48,0.12);
      background:rgba(255,255,255,0.55);
      box-shadow:0 10px 24px rgba(0,0,0,0.06);
      font-weight:950;
      text-transform:uppercase;
      letter-spacing:0.05em;
      font-size:11px;
      color:rgba(26,39,48,0.80);
      margin-bottom:10px;
    }

    .title{
      margin:0;
      font-weight:1000;
      text-transform:uppercase;
      letter-spacing:0.02em;
      line-height:0.96;
      font-size:clamp(28px, 4.8vw, 52px);
      color:rgba(26,39,48,0.92);
      text-shadow: 0 10px 30px rgba(0,0,0,0.10);
    }
    .subtitle{
      margin:10px 0 0;
      color:var(--muted);
      font-weight:850;
      font-size:clamp(13px, 1.8vw, 16px);
      max-width:72ch;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    .map-area{ padding:16px 16px 12px; }

    .map-frame{
      position:relative;
      border-radius:16px;
      border:1px solid rgba(26,39,48,0.10);
      background:rgba(255,255,255,0.55);
      overflow:hidden;
    }

    .map-frame:after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(165deg,
          rgba(255,255,255,0.0) 0%,
          rgba(255,255,255,0.0) 35%,
          rgba(255,255,255,0.26) 36%,
          rgba(255,255,255,0.26) 58%,
          rgba(255,255,255,0.0) 59%,
          rgba(255,255,255,0.0) 100%);
      pointer-events:none;
      opacity:0.55;
    }

    svg{ width:100%; height:auto; display:block; position:relative; z-index:1; }

    .state{
      stroke:var(--mapStroke);
      stroke-width:var(--mapStrokeW);
      stroke-linejoin:round;
      stroke-linecap:round;
    }
    .state:hover{ filter: drop-shadow(0 0 10px rgba(0,0,0,0.10)); }

    .state-outline{
      fill:none;
      stroke:rgba(26,39,48,0.08);
      stroke-width:1;
      pointer-events:none;
    }

    .labels text{
      font-weight:1000;
      letter-spacing:0.02em;
      fill:rgba(26,39,48,0.86);
      paint-order: stroke;
      stroke:rgba(255,255,255,0.92);
      stroke-width:4px;
      stroke-linejoin:round;
      pointer-events:none;
      text-anchor:middle;
      dominant-baseline:middle;
      text-transform:uppercase;
    }

    .tooltip{
      position:absolute;
      pointer-events:none;
      display:none;
      z-index:100;
      background:rgba(255,255,255,0.96);
      border:1px solid rgba(26,39,48,0.14);
      border-radius:14px;
      padding:10px 12px;
      box-shadow:0 18px 44px rgba(0,0,0,0.16);
      max-width:280px;
      backdrop-filter: blur(10px);
    }
    .tooltip strong{
      display:block;
      font-weight:950;
      margin-bottom:4px;
      color:rgba(26,39,48,0.92);
    }
    .tooltip .meta{
      font-weight:900;
      color:rgba(26,39,48,0.86);
      line-height:1.25;
    }
    .tooltip .meta small{
      display:block;
      margin-top:6px;
      font-weight:850;
      color:rgba(26,39,48,0.62);
    }
    .tooltip .pill{
      display:inline-block;
      margin-top:8px;
      font-size:11px;
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      color:#fff;
      letter-spacing:0.02em;
      white-space:nowrap;
    }

    .legend{
      display:grid;
      grid-template-columns:repeat(4, minmax(0,1fr));
      gap:10px;
      margin:12px 0 6px;
    }
    @media (max-width:820px){
      .legend{ grid-template-columns:repeat(2, minmax(0,1fr)); }
    }
    .leg-item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border-radius:14px;
      background:rgba(255,255,255,0.62);
      border:1px solid rgba(26,39,48,0.08);
      min-width:0;
    }
    .swatch{
      width:14px;
      height:14px;
      border-radius:5px;
      border:1px solid rgba(26,39,48,0.10);
      flex:0 0 auto;
    }
    .leg-label{
      font-weight:1000;
      font-size:12px;
      color:rgba(26,39,48,0.90);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .method{
      padding:10px 16px 12px;
      font-size:11px;
      line-height:1.35;
      color:rgba(26,39,48,0.66);
      border-top:1px solid rgba(26,39,48,0.08);
      background:rgba(255,255,255,0.55);
      display:flex;
      gap:14px;
      align-items:flex-end;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .method strong{ color:rgba(26,39,48,0.82); }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      margin-left:auto;
    }
    .logo{
      height:36px;
      width:auto;
      display:block;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,0.12));
    }

    .embed{
      padding:12px 16px 16px;
      background:rgba(255,255,255,0.55);
      border-top:1px solid rgba(26,39,48,0.08);
    }
    .embed-btn{
      appearance:none;
      border:1px solid rgba(26,39,48,0.14);
      background:linear-gradient(90deg, rgba(26,39,48,0.92), rgba(26,39,48,0.78));
      color:#fff;
      font-weight:1000;
      letter-spacing:0.02em;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      box-shadow:0 14px 30px rgba(26,39,48,0.14);
    }
    .embed-btn:hover{ filter:brightness(1.02); transform: translateY(-1px); }
    .embed-panel[hidden]{ display:none; }
    .embed-panel{
      margin-top:10px;
      border:1px solid rgba(26,39,48,0.12);
      border-radius:14px;
      overflow:hidden;
      background:rgba(255,255,255,0.62);
    }
    .embed-panel .ehint{
      padding:10px 12px;
      font-size:11px;
      color:rgba(26,39,48,0.70);
      border-bottom:1px solid rgba(26,39,48,0.10);
      font-weight:850;
    }
    .embed-panel textarea{
      width:100%;
      height:120px;
      padding:10px 12px;
      border:0;
      outline:none;
      resize:none;
      background:transparent;
      color:rgba(26,39,48,0.88);
      font:12px/1.4 var(--mono);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="kicker">Super Bowl parties • Host impressions</div>
      <h1 class="title">Where Super Bowl Hosts<br/>Get Judged on Snacks</h1>
      <div class="subtitle">For each state, this shows the influence level of Super Bowl snacks on opinions of the host (strongly + somewhat).</div>
    </div>

    <div class="card">
      <div class="map-area">
        <div class="map-frame">
          <svg id="map" viewBox="0 0 975 610" role="img" aria-label="Where Super Bowl hosts get judged on snacks — map"></svg>
        </div>

        <div class="legend" id="legend"></div>
      </div>

      <div class="method">
        <div>
          <strong>Methodology:</strong> Based on a RotoGrinders.com survey (Q5). For each state, we calculated <strong>Total influence</strong> =
          <strong>Strongly affects</strong> + <strong>Somewhat affects</strong>, then grouped states into four levels for easier viewing.
          <br><strong>Source:</strong> Survey conducted by <strong>RotoGrinders.com</strong> (n = 3,008 U.S. adults).
        </div>
        <div class="brand" aria-label="Brand">
          <img class="logo" src="https://i.postimg.cc/jqwyS7PB/download.png" alt="Logo" />
        </div>
      </div>

      <div class="embed">
        <button class="embed-btn" id="embedToggle" type="button" aria-controls="embedPanel" aria-expanded="false">
          Get embed code
        </button>

        <div class="embed-panel" id="embedPanel" hidden>
          <div class="ehint">Copy/paste this iframe. Replace the <strong>src</strong> with your hosted URL.</div>
          <textarea id="embedCode" readonly onclick="this.select()"></textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="tooltip" id="tt"></div>

  <script>
    // =========================
    // LEVELS (static-friendly)
    // =========================
    // Total influence = strong + some
    // Map shows level text (HIGH/MED/LOW/VERY LOW) for cleaner screenshots.
    const LEVELS = [
      { key:"high",     level:"HIGH",     range:"50%+",    fill:"#F3B2AC", badge:"rgba(226,96,98,0.92)",  legend:"High influence (50%+)" },
      { key:"med",      level:"MED",      range:"40–49%",  fill:"#F6D7B1", badge:"rgba(240,160,50,0.92)", legend:"Medium influence (40–49%)" },
      { key:"low",      level:"LOW",      range:"30–39%",  fill:"#BFE1DD", badge:"rgba(60,189,176,0.92)", legend:"Low influence (30–39%)" },
      { key:"vlow",     level:"VERY LOW", range:"<30%",    fill:"#E6E8EB", badge:"rgba(26,39,48,0.68)",   legend:"Very low influence (<30%)" }
    ];

    function classify(total){
      if(total >= 50) return LEVELS[0];
      if(total >= 40) return LEVELS[1];
      if(total >= 30) return LEVELS[2];
      return LEVELS[3];
    }

    // Legend
    const legend = document.getElementById("legend");
    legend.innerHTML = LEVELS.map(l => `
      <div class="leg-item">
        <span class="swatch" style="background:${l.fill}"></span>
        <span class="leg-label">${l.legend}</span>
      </div>
    `).join("");

    // =========================
    // Q5 DATA (AS PROVIDED)
    // =========================
    const Q5 = {
      "Alabama":       {strong:15, some:18, notice:35, doesnt:23, noParty:8},
      "Alaska":        {strong:8,  some:19, notice:48, doesnt:19, noParty:6},
      "Arizona":       {strong:21, some:27, notice:31, doesnt:13, noParty:8},
      "Arkansas":      {strong:15, some:20, notice:30, doesnt:28, noParty:8},
      "California":    {strong:24, some:32, notice:27, doesnt:11, noParty:6},
      "Colorado":      {strong:18, some:16, notice:40, doesnt:16, noParty:10},
      "Connecticut":   {strong:14, some:22, notice:43, doesnt:17, noParty:3},
      "Delaware":      {strong:18, some:13, notice:33, doesnt:25, noParty:10},
      "Florida":       {strong:24, some:17, notice:38, doesnt:17, noParty:3},
      "Georgia":       {strong:20, some:20, notice:40, doesnt:15, noParty:5},
      "Hawaii":        {strong:19, some:21, notice:21, doesnt:33, noParty:6},
      "Idaho":         {strong:2,  some:35, notice:18, doesnt:33, noParty:12},
      "Illinois":      {strong:11, some:18, notice:32, doesnt:23, noParty:15},
      "Indiana":       {strong:15, some:25, notice:27, doesnt:23, noParty:10},
      "Iowa":          {strong:14, some:20, notice:34, doesnt:17, noParty:15},
      "Kansas":        {strong:8,  some:20, notice:32, doesnt:30, noParty:10},
      "Kentucky":      {strong:20, some:20, notice:34, doesnt:20, noParty:7},
      "Louisiana":     {strong:29, some:25, notice:26, doesnt:15, noParty:5},
      "Maine":         {strong:15, some:25, notice:32, doesnt:22, noParty:7},
      "Maryland":      {strong:12, some:28, notice:25, doesnt:25, noParty:11},
      "Massachusetts": {strong:23, some:13, notice:31, doesnt:20, noParty:13},
      "Michigan":      {strong:23, some:24, notice:27, doesnt:15, noParty:11},
      "Minnesota":     {strong:5,  some:15, notice:48, doesnt:18, noParty:13},
      "Mississippi":   {strong:32, some:20, notice:23, doesnt:18, noParty:7},
      "Missouri":      {strong:20, some:15, notice:39, doesnt:19, noParty:7},
      "Montana":       {strong:9,  some:15, notice:40, doesnt:20, noParty:16},
      "Nebraska":      {strong:12, some:8,  notice:48, doesnt:18, noParty:13},
      "Nevada":        {strong:17, some:15, notice:31, doesnt:25, noParty:12},
      "New Hampshire": {strong:15, some:20, notice:42, doesnt:18, noParty:5},
      "New Jersey":    {strong:21, some:19, notice:29, doesnt:23, noParty:8},
      "New Mexico":    {strong:13, some:18, notice:33, doesnt:26, noParty:10},
      "New York":      {strong:22, some:36, notice:30, doesnt:6,  noParty:6},
      "North Carolina":{strong:17, some:38, notice:22, doesnt:14, noParty:8},
      "North Dakota":  {strong:17, some:26, notice:19, doesnt:28, noParty:10},
      "Ohio":          {strong:17, some:25, notice:38, doesnt:16, noParty:3},
      "Oklahoma":      {strong:13, some:23, notice:31, doesnt:20, noParty:13},
      "Oregon":        {strong:10, some:30, notice:28, doesnt:25, noParty:8},
      "Pennsylvania":  {strong:17, some:26, notice:29, doesnt:20, noParty:8},
      "Rhode Island":  {strong:15, some:22, notice:45, doesnt:13, noParty:5},
      "South Carolina":{strong:5,  some:15, notice:44, doesnt:22, noParty:14},
      "South Dakota":  {strong:16, some:23, notice:30, doesnt:25, noParty:7},
      "Tennessee":     {strong:22, some:23, notice:28, doesnt:18, noParty:8},
      "Texas":         {strong:19, some:36, notice:23, doesnt:9,  noParty:13},
      "Utah":          {strong:13, some:28, notice:30, doesnt:18, noParty:11},
      "Vermont":       {strong:11, some:24, notice:37, doesnt:16, noParty:13},
      "Virginia":      {strong:13, some:28, notice:36, doesnt:16, noParty:7},
      "Washington":    {strong:19, some:27, notice:33, doesnt:16, noParty:6},
      "West Virginia": {strong:15, some:20, notice:31, doesnt:29, noParty:5},
      "Wisconsin":     {strong:13, some:14, notice:44, doesnt:24, noParty:5},
      "Wyoming":       {strong:22, some:27, notice:27, doesnt:18, noParty:5}
    };

    // Compute totals + levels
    const stateInfo = {};
    Object.keys(Q5).forEach(st => {
      const v = Q5[st];
      const total = (v.strong || 0) + (v.some || 0);
      const cls = classify(total);
      stateInfo[st] = { total, cls, strong:v.strong||0, some:v.some||0 };
    });

    // USPS abbreviations (tiny states)
    const USPS = {
      "Alabama":"AL","Alaska":"AK","Arizona":"AZ","Arkansas":"AR","California":"CA","Colorado":"CO","Connecticut":"CT",
      "Delaware":"DE","Florida":"FL","Georgia":"GA","Hawaii":"HI","Idaho":"ID","Illinois":"IL","Indiana":"IN","Iowa":"IA",
      "Kansas":"KS","Kentucky":"KY","Louisiana":"LA","Maine":"ME","Maryland":"MD","Massachusetts":"MA","Michigan":"MI",
      "Minnesota":"MN","Mississippi":"MS","Missouri":"MO","Montana":"MT","Nebraska":"NE","Nevada":"NV","New Hampshire":"NH",
      "New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND","Ohio":"OH","Oklahoma":"OK",
      "Oregon":"OR","Pennsylvania":"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD","Tennessee":"TN","Texas":"TX",
      "Utah":"UT","Vermont":"VT","Virginia":"VA","Washington":"WA","West Virginia":"WV","Wisconsin":"WI","Wyoming":"WY"
    };

    const forceAbbrev = new Set([
      "Connecticut","Delaware","Maryland","Massachusetts","New Hampshire","New Jersey",
      "Rhode Island","Vermont"
    ]);

    const labelOffsets = {
      "Rhode Island":[10, 10],
      "Connecticut":[-10, 8],
      "Massachusetts":[14, -2],
      "New Jersey":[12, 10],
      "Delaware":[10, 10],
      "Maryland":[-14, 10],
      "New Hampshire":[12, -6],
      "Vermont":[-12, -4],
      "Hawaii":[10, 6]
    };

    // Tooltip helpers
    const tooltip = d3.select("#tt");
    function esc(s){
      return String(s).replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
    }
    function placeTooltip(event){
      const rect = tooltip.node().getBoundingClientRect();
      const pad = 10;
      let x = event.pageX + 12;
      let y = event.pageY + 12;
      if (x + rect.width > window.innerWidth - pad) x = window.innerWidth - rect.width - pad;
      if (y + rect.height > window.innerHeight - pad) y = window.innerHeight - rect.height - pad;
      tooltip.style("left", x+"px").style("top", y+"px");
    }
    function showTip(event, stateName){
      const info = stateInfo[stateName];
      if(!info) return;

      tooltip
        .style("display","block")
        .html(
          `<strong>${esc(stateName)}</strong>
           <div class="meta">${esc(info.cls.legend)} <span style="opacity:0.75">(${info.total}%)</span>
             <small>Strongly: ${info.strong}% · Somewhat: ${info.some}%</small>
           </div>
           <div class="pill" style="background:${info.cls.badge}">${esc(info.cls.level)} influence</div>`
        );

      placeTooltip(event);
    }
    function hideTip(){ tooltip.style("display","none"); }

    // Draw map + labels
    const svg = d3.select("#map");
    const W = 975, H = 610;
    const projection = d3.geoAlbersUsa().scale(1300).translate([W/2, H/2]);
    const path = d3.geoPath(projection);

    function getLabelFont(){
      return window.innerWidth < 520 ? 10.5 : 12.25;
    }

    let cachedUS = null;
    let cachedFeatures = null;

    function renderMap(){
      if(!cachedUS || !cachedFeatures) return;

      svg.selectAll("*").remove();
      svg.attr("viewBox", `0 0 ${W} ${H}`);

      // Fill states
      svg.append("g")
        .selectAll("path")
        .data(cachedFeatures)
        .join("path")
        .attr("class","state")
        .attr("d", path)
        .attr("fill", d => {
          const name = d.properties && d.properties.name;
          const info = stateInfo[name];
          return info ? info.cls.fill : "rgba(26,39,48,0.08)";
        })
        .on("mousemove", (event, d) => {
          const name = d.properties && d.properties.name;
          if(!stateInfo[name]) return hideTip();
          showTip(event, name);
        })
        .on("mouseout", hideTip)
        .on("click", (event, d) => {
          const name = d.properties && d.properties.name;
          if(!stateInfo[name]) return hideTip();
          showTip(event, name);
          event.stopPropagation();
        });

      // Borders
      svg.append("path")
        .datum(topojson.mesh(cachedUS, cachedUS.objects.states, (a,b)=>a!==b))
        .attr("class","state-outline")
        .attr("d", path);

      // Labels: show LEVEL (clean for screenshots)
      const fontSize = getLabelFont();
      const gLabels = svg.append("g").attr("class","labels");

      const labelPoints = cachedFeatures.map(f => {
        const name = f.properties && f.properties.name;
        const info = stateInfo[name];
        if(!info) return null;

        const c = path.centroid(f);
        if(!c || !isFinite(c[0]) || !isFinite(c[1])) return null;

        const [dx,dy] = labelOffsets[name] || [0,0];

        // Tiny states: show abbreviation + level
        const txt = forceAbbrev.has(name)
          ? `${USPS[name]} · ${info.cls.level}`
          : info.cls.level;

        return { name, x:c[0]+dx, y:c[1]+dy, text:txt };
      }).filter(Boolean);

      gLabels.selectAll("text")
        .data(labelPoints)
        .join("text")
        .attr("x", d => d.x)
        .attr("y", d => d.y)
        .style("font-size", fontSize + "px")
        .text(d => d.text);

      document.addEventListener("click", hideTip);
      document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") hideTip(); });
    }

    d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(us => {
      cachedUS = us;
      cachedFeatures = topojson.feature(us, us.objects.states).features;
      renderMap();
    });

    let t = null;
    window.addEventListener("resize", () => {
      clearTimeout(t);
      t = setTimeout(() => renderMap(), 120);
    });

    // Embed logic
    const embedToggle = document.getElementById("embedToggle");
    const embedPanel  = document.getElementById("embedPanel");
    const embedCode   = document.getElementById("embedCode");

    if (embedCode) {
      embedCode.value =
`<iframe
  src="https://aharris-jpg.github.io/super-bowl-snacks2/host-judgment-by-state.html"
  title="Where Super Bowl Hosts Get Judged on Snacks — by State"
  width="100%" height="980"
  style="border:0;overflow:hidden;display:block;width:100%;"
  loading="lazy"></iframe>`;
    }

    if (embedToggle) {
      embedToggle.addEventListener("click", () => {
        const hidden = embedPanel.hasAttribute("hidden");
        if (hidden) {
          embedPanel.removeAttribute("hidden");
          embedToggle.setAttribute("aria-expanded", "true");
          embedToggle.textContent = "Hide embed code";
        } else {
          embedPanel.setAttribute("hidden", "");
          embedToggle.setAttribute("aria-expanded", "false");
          embedToggle.textContent = "Get embed code";
        }
      });
    }
  </script>
</body>
</html>
